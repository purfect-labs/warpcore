<!-- WARP Feature Access Control - Production Ready -->
<div class="warp-features-section">
    <h3>üéØ WARP Feature Access - Tier Comparison</h3>
    <p class="features-description">Access powerful cloud operations based on your license tier:</p>
    
    <div class="feature-buttons-container">
        <!-- Basic Feature Button - Always Available -->
        <div class="feature-button-group basic-feature">
            <div class="feature-header">
                <h4>üÜì Essential Features</h4>
                <div class="feature-status basic">Always Available</div>
            </div>
            <div class="feature-description">
                <p>Essential K8s operations and basic cloud connectivity available to all users.</p>
            </div>
            <button 
                id="basic-feature-btn" 
                class="feature-btn basic-btn" 
                onclick="tryBasicFeature()"
                title="Essential features available to all users"
            >
                üöÄ Access Essential Features
            </button>
            <div class="feature-result" id="basic-feature-result"></div>
        </div>

        <!-- Professional Feature Button - License Required -->
        <div class="feature-button-group professional-feature">
            <div class="feature-header">
                <h4>‚≠ê Professional Features</h4>
                <div class="feature-status professional" id="professional-status">
                    License Required
                </div>
            </div>
            <div class="feature-description">
                <p>Advanced cloud operations, multi-environment support, and enterprise integrations.</p>
            </div>
            <button 
                id="professional-feature-btn" 
                class="feature-btn professional-btn locked" 
                onclick="tryProfessionalFeature()"
                title="Activate a license to unlock professional features"
            >
                üîí Premium Features (License Required)
            </button>
            <div class="feature-result" id="premium-feature-result"></div>
            <div class="license-prompt" id="license-prompt">
                <p class="lock-message">
                    üîê <strong>License Required:</strong> 
                    <a href="#" onclick="showLicenseModal()" class="license-link">Activate license</a> 
                    to unlock this feature
                </p>
            </div>
        </div>
    </div>

    <!-- License Status Display -->
    <div class="license-status-display" id="license-status-display">
        <div class="status-indicator" id="status-indicator">
            <span class="status-badge inactive" id="status-badge">‚ùå No License</span>
            <span class="status-text" id="status-text">Using free tier only</span>
        </div>
        <button class="btn-secondary license-manage-btn" onclick="showLicenseModal()">
            üîë Manage License
        </button>
    </div>
</div>

<style>
.license-poc-section {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.poc-description {
    color: #6c757d;
    margin-bottom: 20px;
    font-style: italic;
}

.feature-buttons-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.feature-button-group {
    border: 2px solid;
    border-radius: 8px;
    padding: 15px;
    position: relative;
}

.free-feature {
    border-color: #28a745;
    background: #f8fff9;
}

.premium-feature {
    border-color: #ffc107;
    background: #fffdf5;
}

.feature-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.feature-header h4 {
    margin: 0;
    font-size: 1.2em;
}

.feature-status {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: bold;
}

.feature-status.free {
    background: #d4edda;
    color: #155724;
}

.feature-status.premium {
    background: #fff3cd;
    color: #856404;
}

.feature-status.premium.unlocked {
    background: #d4edda;
    color: #155724;
}

.feature-description {
    margin-bottom: 15px;
    color: #6c757d;
    font-size: 0.9em;
}

.feature-btn {
    width: 100%;
    padding: 12px 16px;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.free-btn {
    background: #28a745;
    color: white;
}

.free-btn:hover {
    background: #218838;
    transform: translateY(-2px);
}

.premium-btn {
    background: #ffc107;
    color: #212529;
}

.premium-btn:hover:not(.locked) {
    background: #e0a800;
    transform: translateY(-2px);
}

.premium-btn.locked {
    background: #6c757d;
    color: #ffffff;
    cursor: not-allowed;
    opacity: 0.7;
}

.premium-btn.unlocked {
    background: #28a745;
    color: white;
}

.feature-result {
    margin-top: 10px;
    padding: 10px;
    border-radius: 4px;
    display: none;
}

.feature-result.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.feature-result.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.license-prompt {
    margin-top: 10px;
    padding: 8px;
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 4px;
    font-size: 0.9em;
}

.lock-message {
    margin: 0;
    text-align: center;
}

.license-link {
    color: #007bff;
    text-decoration: none;
    font-weight: bold;
}

.license-link:hover {
    text-decoration: underline;
}

.license-status-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 2px solid #dee2e6;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9em;
}

.status-badge.inactive {
    background: #f8d7da;
    color: #721c24;
}

.status-badge.active {
    background: #d4edda;
    color: #155724;
}

.status-text {
    color: #6c757d;
    font-size: 0.9em;
}

.license-manage-btn {
    padding: 8px 16px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
}

.license-manage-btn:hover {
    background: #0056b3;
}

@media (max-width: 768px) {
    .feature-buttons-container {
        grid-template-columns: 1fr;
    }
    
    .license-status-display {
        flex-direction: column;
        gap: 10px;
    }
}
</style>

<script>
// Feature button functionality for License POC Demo

// Global license state
let currentLicenseStatus = {
    active: false,
    tier: 'free',
    features: []
};

// Initialize license status on page load
document.addEventListener('DOMContentLoaded', function() {
    checkLicenseStatus();
    updateButtonStates();
});

async function checkLicenseStatus() {
    try {
        const response = await fetch('/api/license/status');
        const result = await response.json();
        
        if (result.success && result.data) {
            currentLicenseStatus = {
                active: result.data.status === 'active',
                tier: result.data.license_type || 'free',
                features: result.data.features || []
            };
        } else {
            currentLicenseStatus = {
                active: false,
                tier: 'free', 
                features: []
            };
        }
        
        updateButtonStates();
        updateLicenseDisplay();
        
    } catch (error) {
        console.error('Failed to check license status:', error);
        // Assume no license on error
        currentLicenseStatus = {
            active: false,
            tier: 'free',
            features: []
        };
        updateButtonStates();
        updateLicenseDisplay();
    }
}

function updateButtonStates() {
    const premiumBtn = document.getElementById('premium-feature-btn');
    const premiumStatus = document.getElementById('premium-status');
    const licensePrompt = document.getElementById('license-prompt');
    
    if (currentLicenseStatus.active) {
        // License is active - unlock premium features
        premiumBtn.classList.remove('locked');
        premiumBtn.classList.add('unlocked');
        premiumBtn.innerHTML = '‚≠ê Premium Features (Unlocked)';
        premiumBtn.title = 'Click to try premium feature';
        
        premiumStatus.innerHTML = 'Unlocked';
        premiumStatus.classList.add('unlocked');
        
        licensePrompt.style.display = 'none';
    } else {
        // No license - lock premium features
        premiumBtn.classList.add('locked');
        premiumBtn.classList.remove('unlocked');
        premiumBtn.innerHTML = 'üîí Premium Features (License Required)';
        premiumBtn.title = 'Activate a license to unlock premium features';
        
        premiumStatus.innerHTML = 'License Required';
        premiumStatus.classList.remove('unlocked');
        
        licensePrompt.style.display = 'block';
    }
}

function updateLicenseDisplay() {
    const statusBadge = document.getElementById('status-badge');
    const statusText = document.getElementById('status-text');
    
    if (currentLicenseStatus.active) {
        statusBadge.innerHTML = '‚úÖ License Active';
        statusBadge.className = 'status-badge active';
        statusText.innerHTML = `${currentLicenseStatus.tier.toUpperCase()} tier enabled`;
    } else {
        statusBadge.innerHTML = '‚ùå No License';
        statusBadge.className = 'status-badge inactive';
        statusText.innerHTML = 'Using free tier only';
    }
}

function tryBasicFeature() {
    const resultDiv = document.getElementById('basic-feature-result');
    
    // Show success - basic features always work
    resultDiv.className = 'feature-result success';
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
        <strong>‚úÖ Essential Features Available!</strong><br>
        <small>Essential functionality available to all users including kubectl access and basic cloud operations.</small>
        <br><small>Accessed at: ${new Date().toLocaleTimeString()}</small>
    `;
    
    // Hide after 5 seconds
    setTimeout(() => {
        resultDiv.style.display = 'none';
    }, 5000);
}

function tryProfessionalFeature() {
    const resultDiv = document.getElementById('premium-feature-result');
    
    if (!currentLicenseStatus.active) {
        // Show lock message
        resultDiv.className = 'feature-result error';
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
            <strong>üîí Professional Features Locked</strong><br>
            <small>Advanced cloud operations require an active license. Please activate a license to continue.</small>
            <br><br>
            <button onclick="showLicenseModal()" class="btn-primary" style="padding: 6px 12px; font-size: 0.8em;">
                üîë Activate License Now
            </button>
        `;
        
        // Hide after 8 seconds
        setTimeout(() => {
            resultDiv.style.display = 'none';
        }, 8000);
        
    } else {
        // Show professional success
        resultDiv.className = 'feature-result success';
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
            <strong>‚≠ê Professional Features Available!</strong><br>
            <small>Advanced functionality unlocked including multi-environment support and enterprise integrations.</small>
            <br><small>License tier: ${currentLicenseStatus.tier.toUpperCase()}</small>
        `;
        
        // Hide after 5 seconds
        setTimeout(() => {
            resultDiv.style.display = 'none';
        }, 5000);
    }
}

// Listen for license status changes
window.addEventListener('licenseStatusChanged', function(event) {
    currentLicenseStatus = event.detail;
    updateButtonStates();
    updateLicenseDisplay();
});

// Refresh license status when license modal closes
function refreshLicenseStatusForPOC() {
    setTimeout(() => {
        checkLicenseStatus();
    }, 1000);
}

// Override the close license modal function to refresh status
const originalCloseLicenseModal = window.closeLicenseModal;
if (originalCloseLicenseModal) {
    window.closeLicenseModal = function() {
        originalCloseLicenseModal();
        refreshLicenseStatusForPOC();
    };
}
</script>