<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARPCORE Agent Dashboard - Complete Schema Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            padding: 2rem;
            background: rgba(0,0,0,0.3);
            border-bottom: 3px solid #00ff88;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .franchise-tabs {
            display: flex;
            justify-content: center;
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tab-button {
            padding: 1rem 2rem;
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            color: #ffffff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tab-button:hover {
            background: rgba(255,255,255,0.2);
            border-color: #00ff88;
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            color: #000000;
            border-color: #ffffff;
        }
        
        .franchise-content {
            display: none;
            padding: 2rem;
        }
        
        .franchise-content.active {
            display: block;
        }
        
        .franchise-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border: 2px solid #00ff88;
            position: relative;
        }
        
        .flow-diagram-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,255,136,0.3);
        }
        
        .flow-diagram-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0,255,136,0.6);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: rgba(0,0,0,0.95);
            border: 3px solid #00ff88;
            border-radius: 15px;
            padding: 2rem;
            max-width: 95vw;
            max-height: 95vh;
            overflow: auto;
            position: relative;
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #333;
        }
        
        .modal-title {
            color: #00ff88;
            font-size: 1.8rem;
            margin: 0;
        }
        
        .close-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #ff5252;
            transform: rotate(90deg);
        }
        
        .flow-diagram-img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            border: 2px solid #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        /* Cache Browser Styles */
        .main-tabs {
            display: flex;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            gap: 1rem;
        }
        
        .main-tab {
            padding: 1rem 2rem;
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            color: #ffffff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .main-tab:hover {
            background: rgba(255,255,255,0.2);
            border-color: #00ccff;
            transform: translateY(-2px);
        }
        
        .main-tab.active {
            background: linear-gradient(45deg, #00ccff, #00ff88);
            color: #000000;
            border-color: #ffffff;
        }
        
        .main-content {
            display: none;
        }
        
        .main-content.active {
            display: block;
        }
        
        .cache-browser {
            padding: 2rem;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .cache-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border: 2px solid #00ccff;
        }
        
        .cache-explorer {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            border: 2px solid #333;
            overflow: hidden;
        }
        
        .cache-toolbar {
            padding: 1rem;
            background: linear-gradient(90deg, #333, #444);
            border-bottom: 2px solid #00ccff;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .breadcrumb {
            color: #00ccff;
            font-family: monospace;
            font-size: 0.9rem;
            flex: 1;
        }
        
        .refresh-btn {
            background: #00ccff;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #00ff88;
        }
        
        .cache-content {
            padding: 1rem;
            min-height: 400px;
        }
        
        .file-list {
            display: grid;
            gap: 0.5rem;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: monospace;
        }
        
        .file-item:hover {
            background: rgba(255,255,255,0.1);
            border-left: 4px solid #00ccff;
        }
        
        .file-item.directory {
            border-left: 4px solid #00ff88;
        }
        
        .file-item.directory:hover {
            border-left: 4px solid #ffaa00;
        }
        
        .file-icon {
            margin-right: 1rem;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }
        
        .file-name {
            flex: 1;
            color: #e0e0e0;
        }
        
        .file-size {
            color: #999;
            font-size: 0.8rem;
            margin-left: 1rem;
        }
        
        .file-content {
            background: rgba(0,0,0,0.6);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid #333;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .file-content pre {
            margin: 0;
            color: #e0e0e0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        /* File viewer modal */
        .file-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .file-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .file-modal-content {
            background: rgba(0,0,0,0.98);
            border: 3px solid #00ccff;
            border-radius: 15px;
            padding: 0;
            max-width: 95vw;
            max-height: 95vh;
            overflow: hidden;
            position: relative;
            transform: scale(0.7);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .file-modal.show .file-modal-content {
            transform: scale(1);
        }
        
        .file-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background: linear-gradient(90deg, #333, #444);
            border-bottom: 2px solid #00ccff;
            border-radius: 12px 12px 0 0;
        }
        
        .file-modal-title {
            color: #00ccff;
            font-size: 1.5rem;
            margin: 0;
            font-family: monospace;
        }
        
        .file-modal-body {
            padding: 2rem;
            overflow: auto;
            flex: 1;
            min-height: 200px;
            max-height: 70vh;
        }
        
        .file-modal-pre {
            margin: 0;
            color: #e0e0e0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            background: rgba(0,0,0,0.5);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #333;
            overflow: auto;
        }
        
        .json-highlight .json-key {
            color: #00ccff;
            font-weight: bold;
        }
        
        .json-highlight .json-string {
            color: #00ff88;
        }
        
        .json-highlight .json-number {
            color: #ffaa00;
        }
        
        .json-highlight .json-boolean {
            color: #ff6b6b;
        }
        
        .json-highlight .json-null {
            color: #999;
        }
        
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .agent-card {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            border: 2px solid #333;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .agent-card:hover {
            border-color: #00ff88;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,255,136,0.3);
        }
        
        .agent-header {
            padding: 1rem;
            background: linear-gradient(90deg, #333, #444);
            border-bottom: 2px solid #00ff88;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .agent-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        .agent-id {
            font-size: 0.9rem;
            color: #00ccff;
            background: rgba(0,0,0,0.3);
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
        }
        
        .expand-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
            color: #00ff88;
        }
        
        .agent-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .agent-content.expanded {
            max-height: 2000px;
        }
        
        .agent-details {
            padding: 1rem;
        }
        
        .detail-tabs {
            display: flex;
            margin-bottom: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .detail-tab {
            flex: 1;
            padding: 0.7rem;
            background: transparent;
            border: none;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .detail-tab:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }
        
        .detail-tab.active {
            background: #00ff88;
            color: #000;
        }
        
        .detail-content {
            display: none;
            background: rgba(0,0,0,0.5);
            border-radius: 6px;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .detail-content.active {
            display: block;
        }
        
        .json-viewer {
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            white-space: pre-wrap;
            color: #e0e0e0;
        }
        
        .json-key {
            color: #00ccff;
            font-weight: bold;
        }
        
        .json-string {
            color: #00ff88;
        }
        
        .json-number {
            color: #ffaa00;
        }
        
        .json-boolean {
            color: #ff6b6b;
        }
        
        .json-null {
            color: #999;
        }
        
        .schema-info {
            display: grid;
            gap: 1rem;
        }
        
        .schema-section {
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            padding: 1rem;
            border-left: 4px solid #00ff88;
        }
        
        .schema-title {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .schema-content {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .schema-list {
            list-style: none;
            padding-left: 1rem;
        }
        
        .schema-list li {
            margin-bottom: 0.3rem;
            position: relative;
        }
        
        .schema-list li:before {
            content: "▶";
            color: #00ff88;
            position: absolute;
            left: -1rem;
        }
        
        .polymorphic-mapping {
            background: linear-gradient(45deg, rgba(0,255,136,0.1), rgba(0,204,255,0.1));
            border: 1px solid #00ff88;
            border-radius: 6px;
            padding: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .mapping-type {
            color: #00ccff;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .search-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .search-box {
            padding: 0.8rem;
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ff88;
            border-radius: 25px;
            color: #fff;
            font-size: 0.9rem;
            width: 250px;
            outline: none;
        }
        
        .search-box::placeholder {
            color: #aaa;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 2px solid #333;
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff88;
            display: block;
        }
        
        .stat-label {
            color: #ccc;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            font-size: 1.2rem;
            color: #00ff88;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00ff88;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #00ccff;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <input type="text" class="search-box" placeholder="Search agents, schemas, properties..." id="searchBox">
    </div>
    
    <div class="header">
        <h1>🚀 WARPCORE Agent Dashboard</h1>
        <p>Complete Schema & JSON Viewer for All Franchise Agents</p>
    </div>
    
    <div class="stats-bar" id="statsBar">
        <div class="stat-item">
            <span class="stat-number" id="totalAgents">0</span>
            <span class="stat-label">Total Agents</span>
        </div>
        <div class="stat-item">
            <span class="stat-number" id="totalFranchises">0</span>
            <span class="stat-label">Franchises</span>
        </div>
        <div class="stat-item">
            <span class="stat-number" id="polymorphicMappings">0</span>
            <span class="stat-label">Polymorphic Mappings</span>
        </div>
    </div>
    
    <!-- Main Navigation Tabs -->
    <div class="main-tabs">
        <button class="main-tab active" onclick="showMainTab('agents')">🤖 Agents</button>
        <button class="main-tab" onclick="showMainTab('cache')">💾 Cache Browser</button>
    </div>
    
    <!-- Agents Section -->
    <div class="main-content active" id="agentsSection">
        <div class="franchise-tabs" id="franchiseTabs">
            <!-- Tabs will be populated by JavaScript -->
        </div>
        
        <div id="franchiseContent">
            <!-- Content will be populated by JavaScript -->
        </div>
    </div>
    
    <!-- Cache Browser Section -->
    <div class="main-content" id="cacheSection">
        <div class="cache-browser">
            <div class="cache-header">
                <h2>💾 Agency Cache Explorer</h2>
                <p>Browse and inspect agency cache files and directories</p>
            </div>
            
            <div class="cache-explorer">
                <div class="cache-toolbar">
                    <div class="breadcrumb" id="cacheBreadcrumb">~/agency_cache/</div>
                    <button class="refresh-btn" onclick="refreshCache()">🔄 Refresh</button>
                </div>
                
                <div class="cache-content" id="cacheContent">
                    <div class="file-list" id="fileList">
                        <!-- Files will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="loading" id="loading">
        🔄 Loading agent data and schemas...
    </div>
    
    <!-- Flow Diagram Modal -->
    <div class="modal-overlay" id="flowModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Flow Diagram</h3>
                <button class="close-btn" onclick="closeFlowModal()">&times;</button>
            </div>
            <img class="flow-diagram-img" id="flowImage" src="" alt="Flow Diagram" />
        </div>
    </div>
    
    <!-- File Viewer Modal -->
    <div class="file-modal" id="fileModal">
        <div class="file-modal-content">
            <div class="file-modal-header">
                <h3 class="file-modal-title" id="fileModalTitle">📄 File Viewer</h3>
                <button class="close-btn" onclick="closeFileModal()">&times;</button>
            </div>
            <div class="file-modal-body" id="fileModalBody">
                <!-- File content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        class WARPCOREDashboard {
            constructor() {
                this.agentData = {};
                this.polymorphicMappings = this.getPolymorphicMappings();
                this.currentFranchise = null;
                this.searchTerm = '';
                this.init();
            }
            
            getPolymorphicMappings() {
                return {
                    // Staff franchise (legacy)
                    "bootstrap_agent": "BootstrapAgentSchema",
                    "workflow_orchestrator_agent": "OrchestratorAgentSchema", 
                    "schema_coherence_reconciler_agent": "SchemaReconcilerAgentSchema",
                    "requirements_generator_agent": "RequirementsGeneratorAgentSchema",
                    "requirements_validator_agent": "RequirementsValidatorAgentSchema",
                    "implementation_agent": "ImplementationAgentSchema",
                    "gate_promote_agent": "GatePromoteAgentSchema",
                    "user_input_requirements_translator": "UserInputTranslatorAgentSchema",
                    
                    // Framer franchise mappings
                    "origin": "BootstrapAgentSchema",
                    "boss": "OrchestratorAgentSchema",
                    "pathfinder": "SchemaReconcilerAgentSchema",
                    "oracle": "UserInputTranslatorAgentSchema",
                    "architect": "RequirementsGeneratorAgentSchema",
                    "enforcer": "RequirementsValidatorAgentSchema",
                    "craftsman_implementation": "ImplementationAgentSchema",
                    "craftbuddy": "RequirementsGeneratorAgentSchema",
                    "gatekeeper": "GatePromoteAgentSchema",
                    "ghostwriter": "RequirementsGeneratorAgentSchema",
                    "alice": "RequirementsValidatorAgentSchema",
                    "flux": "ImplementationAgentSchema",
                    "mama_bear": "GatePromoteAgentSchema",
                    "harmony": "SchemaReconcilerAgentSchema",
                    
                    // PATROL franchise mappings
                    "deep": "RequirementsGeneratorAgentSchema",
                    "cipher": "RequirementsValidatorAgentSchema",
                    "glitch": "ImplementationAgentSchema",
                    "zero": "GatePromoteAgentSchema"
                };
            }
            
            async init() {
                try {
                    console.log('Starting dashboard initialization...');
                    await this.loadAgentData();
                    console.log('Agent data loaded, rendering dashboard...');
                    await this.renderDashboard();
                    console.log('Dashboard rendered, binding events...');
                    this.bindEvents();
                    console.log('Events bound, hiding loading screen...');
                    document.getElementById('loading').style.display = 'none';
                    console.log('Dashboard initialization complete!');
                } catch (error) {
                    console.error('Dashboard initialization failed:', error);
                    document.getElementById('loading').innerHTML = `❌ Error: ${error.message}<br><small>Check console for details</small>`;
                }
            }
            
            async loadAgentData() {
                try {
                    // Try simplified data first (faster loading)
                    console.log('Trying to load simplified dashboard data...');
                    const simpleResponse = await fetch('./dashboard_data_simple.json');
                    if (simpleResponse.ok) {
                        const data = await simpleResponse.json();
                        this.agentData = data.franchises;
                        if (data.polymorphic_mappings) {
                            this.polymorphicMappings = data.polymorphic_mappings;
                        }
                        console.log('Loaded simplified agent data:', data.metadata);
                        return;
                    }
                } catch (error) {
                    console.warn('Could not load simplified data, trying full data:', error);
                }
                
                try {
                    // Fallback to full agent data
                    console.log('Loading full dashboard data...');
                    const response = await fetch('./dashboard_data.json');
                    if (response.ok) {
                        const data = await response.json();
                        this.agentData = data.franchises;
                        if (data.polymorphic_mappings) {
                            this.polymorphicMappings = data.polymorphic_mappings;
                        }
                        console.log('Loaded full agent data:', data.metadata);
                        return;
                    }
                } catch (error) {
                    console.warn('Could not load full agent data, using simulated data:', error);
                }
                
                // Final fallback to simulated data
                console.log('Using simulated data as fallback');
                this.agentData = await this.loadSimulatedAgentData();
            }
            
            async loadSimulatedAgentData() {
                // Simulate loading agent data from different franchises
                const franchises = ['apex', 'framer', 'staff', 'patrol'];
                const data = {};
                
                for (const franchise of franchises) {
                    data[franchise] = await this.loadFranchiseAgents(franchise);
                }
                
                return data;
            }
            
            async loadFranchiseAgents(franchise) {
                // Simulate agent data structure
                const agentTemplates = {
                    apex: [
                        {name: "commander", id: "commander", file: "1_commander_from_user_to_tactician.json"},
                        {name: "tactician", id: "tactician", file: "2_tactician_from_commander_to_operator.json"},
                        {name: "operator", id: "operator", file: "3_operator_from_tactician_to_complete.json"},
                        {name: "intel", id: "intel", file: "4_intel_from_user_to_commander.json"}
                    ],
                    framer: [
                        {name: "origin", id: "origin", file: "0a_origin_from_none_to_boss.json"},
                        {name: "boss", id: "boss", file: "0b_boss_from_origin_to_pathfinder.json"},
                        {name: "pathfinder", id: "pathfinder", file: "1a_pathfinder_from_boss_to_architect.json"},
                        {name: "oracle", id: "oracle", file: "1b_oracle_from_user_to_architect.json"},
                        {name: "architect", id: "architect", file: "2_architect_from_pathfinder_oracle_to_enforcer.json"},
                        {name: "enforcer", id: "enforcer", file: "3_enforcer_from_architect_craftbuddy_to_craftsman.json"},
                        {name: "craftsman", id: "craftsman_implementation", file: "4a_craftsman_from_enforcer_craftbuddy_to_gatekeeper_craftbuddy.json"},
                        {name: "craftbuddy", id: "craftbuddy", file: "4b_craftbuddy_from_craftsman_alice_to_craftsman_alice.json"},
                        {name: "gatekeeper", id: "gatekeeper", file: "5_gatekeeper_from_craftsman_to_ghostwriter_pathfinder.json"},
                        {name: "ghostwriter", id: "ghostwriter", file: "6_ghostwriter_from_gatekeeper_craftbuddy_to_craftbuddy_alice.json"},
                        {name: "alice", id: "alice", file: "7_alice_from_ghostwriter_to_flux.json"},
                        {name: "flux", id: "flux", file: "8_flux_from_alice_to_pathfinder.json"},
                        {name: "harmony", id: "harmony", file: "harmony_from_user.json"},
                        {name: "mama_bear", id: "mama_bear", file: "mama_bear_from_user.json"}
                    ],
                    staff: [
                        {name: "origin", id: "origin", file: "0a_origin_from_none_to_boss.json"},
                        {name: "boss", id: "boss", file: "0b_boss_from_origin_to_pathfinder.json"},
                        {name: "pathfinder", id: "pathfinder", file: "1a_pathfinder_from_boss_to_architect.json"},
                        {name: "oracle", id: "oracle", file: "1b_oracle_from_user_to_architect.json"},
                        {name: "architect", id: "architect", file: "2_architect_from_pathfinder_oracle_to_enforcer.json"},
                        {name: "enforcer", id: "enforcer", file: "3_enforcer_from_architect_to_craftsman.json"},
                        {name: "craftsman", id: "craftsman_implementation", file: "4a_craftsman_from_enforcer_craftbuddy_to_gatekeeper_craftbuddy.json"},
                        {name: "craftbuddy", id: "craftbuddy", file: "4b_craftbuddy_from_craftsman_to_craftsman.json"},
                        {name: "gatekeeper", id: "gatekeeper", file: "5_gatekeeper_from_craftsman_to_pathfinder.json"},
                        {name: "harmony", id: "harmony", file: "harmony_meta_coherence_agent.json"},
                        {name: "mama_bear", id: "mama_bear", file: "mama_bear.json"}
                    ],
                    patrol: [
                        {name: "origin", id: "origin", file: "0a_origin_from_none_to_boss.json"},
                        {name: "boss", id: "boss", file: "0b_boss_from_origin_to_pathfinder.json"},
                        {name: "pathfinder", id: "pathfinder", file: "1a_pathfinder_from_boss_to_architect.json"},
                        {name: "oracle", id: "oracle", file: "1b_oracle_from_user_to_architect.json"},
                        {name: "architect", id: "architect", file: "2_architect_from_pathfinder_oracle_to_enforcer.json"},
                        {name: "enforcer", id: "enforcer", file: "3_enforcer_from_architect_to_craftsman.json"},
                        {name: "craftsman", id: "craftsman_implementation", file: "4a_craftsman_from_enforcer_to_craftbuddy_gatekeeper.json"},
                        {name: "craftbuddy", id: "craftbuddy", file: "4b_craftbuddy_from_craftsman_to_craftsman.json"},
                        {name: "gatekeeper", id: "gatekeeper", file: "5_gatekeeper_from_craftsman_to_deep_pathfinder.json"},
                        {name: "deep", id: "deep", file: "7_deep_from_craftsman_to_cipher.json"},
                        {name: "cipher", id: "cipher", file: "8_cipher_from_deep_to_glitch.json"},
                        {name: "glitch", id: "glitch", file: "9_glitch_from_cipher_to_zero.json"},
                        {name: "zero", id: "zero", file: "10_zero_from_glitch_to_complete.json"},
                        {name: "harmony", id: "harmony", file: "harmony_from_user.json"},
                        {name: "mama_bear", id: "mama_bear", file: "mama_bear_from_user.json"}
                    ]
                };
                
                return agentTemplates[franchise].map(agent => ({
                    ...agent,
                    json_data: this.generateMockAgentData(agent.id, franchise),
                    polymorphic_schema: this.getPolymorphicSchema(agent.id)
                }));
            }
            
            generateMockAgentData(agentId, franchise) {
                return {
                    agent_id: agentId,
                    agent_version: "2.0.0",
                    franchise: franchise,
                    static_build_info: {
                        build_timestamp: new Date().toISOString(),
                        build_type: "STATIC_MERGED",
                        polymorphic_enhanced: true,
                        self_contained: true
                    },
                    output_schema: {
                        workflow_id: "string (from context)",
                        agent_id: `string (${agentId})`,
                        timestamp: "string (ISO_TIMESTAMP)",
                        comprehensive_caching_info: {
                            workflow_cache: "Standard JSON for next agent",
                            asset_cache: "ALL generated work products",
                            artifacts_cache: "ONLY truly remarkable discoveries"
                        },
                        execution_metrics: {
                            start_time: "string (ISO_TIMESTAMP)",
                            end_time: "string (ISO_TIMESTAMP)",
                            duration_seconds: "number",
                            memory_usage_mb: "number",
                            cpu_usage_percent: "number"
                        },
                        performance_metrics: {
                            output_quality_score: "number (0-100)",
                            efficiency_rating: "EXCELLENT|GOOD|FAIR|POOR"
                        }
                    },
                    validation_rules: [
                        "All outputs must be written to BOTH primary and secondary cache locations",
                        "Cache acknowledgment must be created immediately before starting work",
                        "Asset cache must be used for all generated work products",
                        "Workflow_id must be properly validated"
                    ],
                    success_criteria: [
                        "Historical workflow data compressed for storage efficiency",
                        "Dual cache write operations completed successfully",
                        "Asset cache properly organized with appropriate subdirectories",
                        "Comprehensive caching strategy implemented successfully"
                    ]
                };
            }
            
            getPolymorphicSchema(agentId) {
                const mapping = this.polymorphicMappings[agentId];
                if (!mapping) return null;
                
                return {
                    schema_class: mapping,
                    base_features: [
                        "Data compression tracking",
                        "Bonus contributions identification",
                        "Base execution metrics",
                        "Universal validation rules",
                        "Shared success criteria"
                    ],
                    specific_features: this.getSchemaSpecificFeatures(mapping)
                };
            }
            
            getSchemaSpecificFeatures(schemaClass) {
                const features = {
                    "BootstrapAgentSchema": [
                        "System health validation",
                        "Agent discovery results",
                        "Bootstrap configuration",
                        "Orchestrator preparation"
                    ],
                    "OrchestratorAgentSchema": [
                        "Agent sequencing",
                        "Workflow coordination",
                        "Agent lifecycle management",
                        "Orchestration success tracking"
                    ],
                    "SchemaReconcilerAgentSchema": [
                        "File analysis summary",
                        "Coherence issue detection",
                        "PAP compliance scoring",
                        "Detailed findings reporting"
                    ],
                    "RequirementsGeneratorAgentSchema": [
                        "Requirements enumeration",
                        "Priority classification",
                        "Implementation phases",
                        "Dependency mapping"
                    ],
                    "RequirementsValidatorAgentSchema": [
                        "Requirements validation",
                        "PAP compliance checking",
                        "Feasibility assessment",
                        "Implementation readiness"
                    ],
                    "ImplementationAgentSchema": [
                        "Code implementation",
                        "Test execution",
                        "File modifications",
                        "Git preparation"
                    ],
                    "GatePromoteAgentSchema": [
                        "Cross-agent validation",
                        "Git operations",
                        "Gate decision making",
                        "Workflow completion"
                    ],
                    "UserInputTranslatorAgentSchema": [
                        "Input processing",
                        "Requirements extraction",
                        "Translation accuracy",
                        "Structured output generation"
                    ]
                };
                
                return features[schemaClass] || ["Generic polymorphic features"];
            }
            
            async renderDashboard() {
                console.log('Rendering stats...');
                this.renderStats();
                console.log('Rendering tabs...');
                this.renderTabs();
                console.log('Rendering content...');
                await this.renderContent();
                console.log('Dashboard render complete.');
            }
            
            renderStats() {
                const totalAgents = Object.values(this.agentData).reduce((sum, agents) => sum + agents.length, 0);
                const totalFranchises = Object.keys(this.agentData).length;
                const totalMappings = Object.keys(this.polymorphicMappings).length;
                
                document.getElementById('totalAgents').textContent = totalAgents;
                document.getElementById('totalFranchises').textContent = totalFranchises;
                document.getElementById('polymorphicMappings').textContent = totalMappings;
            }
            
            renderTabs() {
                const tabsContainer = document.getElementById('franchiseTabs');
                const franchises = Object.keys(this.agentData);
                
                tabsContainer.innerHTML = franchises.map(franchise => 
                    `<button class="tab-button" data-franchise="${franchise}">
                        ${franchise.toUpperCase()}
                        <span style="display:block;font-size:0.7rem;opacity:0.8;">
                            ${this.agentData[franchise].length} agents
                        </span>
                    </button>`
                ).join('');
                
                // Tab activation will happen after content is rendered
            }
            
            async renderContent() {
                const contentContainer = document.getElementById('franchiseContent');
                const franchises = Object.keys(this.agentData);
                
                console.log(`Rendering ${franchises.length} franchises...`);
                
                const franchiseHTML = [];
                for (const franchise of franchises) {
                    console.log(`Rendering ${franchise} franchise with ${this.agentData[franchise].length} agents...`);
                    const agentsHTML = await this.renderAgents(franchise);
                    franchiseHTML.push(
                        `<div class="franchise-content" id="content-${franchise}">
                            <div class="franchise-header">
                                <button class="flow-diagram-btn" onclick="openFlowModal('${franchise}')" title="View Agent Flow Diagram">
                                    📊
                                </button>
                                <h2>🏢 ${franchise.toUpperCase()} Franchise</h2>
                                <p>${this.agentData[franchise].length} agents with polymorphic schema integration</p>
                            </div>
                            <div class="agent-grid">
                                ${agentsHTML}
                            </div>
                        </div>`
                    );
                    // Small delay to prevent blocking
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
                
                contentContainer.innerHTML = franchiseHTML.join('');
                console.log('Content rendering complete.');
                
                // Now activate the first tab
                if (franchises.length > 0) {
                    console.log(`Activating first tab: ${franchises[0]}`);
                    this.setActiveTab(franchises[0]);
                }
            }
            
            async renderAgents(franchise) {
                const agents = this.agentData[franchise];
                const agentHTML = [];
                
                for (let i = 0; i < agents.length; i++) {
                    const agent = agents[i];
                    console.log(`Rendering agent ${i + 1}/${agents.length}: ${agent.name}`);
                    
                    try {
                        const html = `<div class="agent-card" data-agent="${agent.id}">
                            <div class="agent-header" onclick="this.parentElement.querySelector('.agent-content').classList.toggle('expanded'); this.querySelector('.expand-icon').style.transform = this.parentElement.querySelector('.agent-content').classList.contains('expanded') ? 'rotate(90deg)' : 'rotate(0deg)'">
                                <div class="agent-name">${agent.name}</div>
                                <div class="agent-id">${agent.id}</div>
                                <div class="expand-icon">▶</div>
                            </div>
                            <div class="agent-content">
                                <div class="agent-details">
                                    <div class="detail-tabs">
                                        <button class="detail-tab active" onclick="this.parentElement.parentElement.querySelector('.detail-content.active').classList.remove('active'); this.parentElement.parentElement.querySelector('#json-${agent.id}').classList.add('active'); this.parentElement.querySelector('.detail-tab.active').classList.remove('active'); this.classList.add('active')">JSON Schema</button>
                                        <button class="detail-tab" onclick="this.parentElement.parentElement.querySelector('.detail-content.active').classList.remove('active'); this.parentElement.parentElement.querySelector('#polymorphic-${agent.id}').classList.add('active'); this.parentElement.querySelector('.detail-tab.active').classList.remove('active'); this.classList.add('active')">Polymorphic</button>
                                        <button class="detail-tab" onclick="this.parentElement.parentElement.querySelector('.detail-content.active').classList.remove('active'); this.parentElement.parentElement.querySelector('#build-${agent.id}').classList.add('active'); this.parentElement.querySelector('.detail-tab.active').classList.remove('active'); this.classList.add('active')">Build Info</button>
                                    </div>
                                    
                                    <div class="detail-content active" id="json-${agent.id}">
                                        <div class="json-viewer">${this.formatJSON(agent.json_data)}</div>
                                    </div>
                                    
                                    <div class="detail-content" id="polymorphic-${agent.id}">
                                        ${this.renderPolymorphicInfo(agent)}
                                    </div>
                                    
                                    <div class="detail-content" id="build-${agent.id}">
                                        ${this.renderBuildInfo(agent)}
                                    </div>
                                </div>
                            </div>
                        </div>`;
                        
                        agentHTML.push(html);
                    } catch (error) {
                        console.error(`Error rendering agent ${agent.name}:`, error);
                        agentHTML.push(`<div class="agent-card error">Error rendering ${agent.name}: ${error.message}</div>`);
                    }
                    
                    // Small delay every 5 agents to prevent blocking
                    if (i % 5 === 0 && i > 0) {
                        await new Promise(resolve => setTimeout(resolve, 5));
                    }
                }
                
                return agentHTML.join('');
            }
            
            renderPolymorphicInfo(agent) {
                const schema = agent.polymorphic_schema;
                if (!schema) {
                    return `<div class="schema-section">
                        <div class="schema-title">No Polymorphic Mapping</div>
                        <div class="schema-content">This agent does not have a polymorphic schema mapping.</div>
                    </div>`;
                }
                
                return `
                    <div class="schema-section">
                        <div class="schema-title">Schema Class</div>
                        <div class="polymorphic-mapping">
                            <div class="mapping-type">${schema.schema_class}</div>
                        </div>
                    </div>
                    
                    <div class="schema-section">
                        <div class="schema-title">Base Features</div>
                        <div class="schema-content">
                            <ul class="schema-list">
                                ${schema.base_features.map(feature => `<li>${feature}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div class="schema-section">
                        <div class="schema-title">Specific Features</div>
                        <div class="schema-content">
                            <ul class="schema-list">
                                ${schema.specific_features.map(feature => `<li>${feature}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            renderBuildInfo(agent) {
                const buildInfo = agent.json_data.static_build_info || {};
                const outputSchema = agent.json_data.output_schema || {};
                const cachingInfo = outputSchema.comprehensive_caching_info || {};
                
                let buildStatusHTML = `
                    <div class="schema-section">
                        <div class="schema-title">Build Status</div>
                        <div class="schema-content">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Type:</strong> ${buildInfo.build_type || 'Unknown'}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Timestamp:</strong> ${buildInfo.build_timestamp ? new Date(buildInfo.build_timestamp).toLocaleString() : 'Unknown'}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Polymorphic Enhanced:</strong> ${buildInfo.polymorphic_enhanced ? '✅ Yes' : '❌ No'}
                            </div>
                            <div>
                                <strong>Self Contained:</strong> ${buildInfo.self_contained ? '✅ Yes' : '❌ No'}
                            </div>
                        </div>
                    </div>`;
                
                // Only show caching section if caching info exists
                if (Object.keys(cachingInfo).length > 0) {
                    buildStatusHTML += `
                    <div class="schema-section">
                        <div class="schema-title">Caching Strategy</div>
                        <div class="schema-content">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Workflow Cache:</strong> ${cachingInfo.workflow_cache || 'Not specified'}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Asset Cache:</strong> ${cachingInfo.asset_cache || 'Not specified'}
                            </div>
                            <div>
                                <strong>Artifacts Cache:</strong> ${cachingInfo.artifacts_cache || 'Not specified'}
                            </div>
                        </div>
                    </div>`;
                } else {
                    buildStatusHTML += `
                    <div class="schema-section">
                        <div class="schema-title">Agent Metadata</div>
                        <div class="schema-content">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Agent ID:</strong> ${agent.json_data.agent_id || agent.id}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Version:</strong> ${agent.json_data.version || agent.json_data.agent_version || 'Unknown'}
                            </div>
                            <div>
                                <strong>Franchise:</strong> ${agent.json_data.franchise || agent.franchise}
                            </div>
                        </div>
                    </div>`;
                }
                
                return buildStatusHTML;
            }
            
            formatJSON(obj) {
                return JSON.stringify(obj, null, 2)
                    .replace(/(".*?"):/g, '<span class="json-key">$1</span>:')
                    .replace(/: (".*?")/g, ': <span class="json-string">$1</span>')
                    .replace(/: (\d+\.?\d*)/g, ': <span class="json-number">$1</span>')
                    .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                    .replace(/: (null)/g, ': <span class="json-null">$1</span>');
            }
            
            setActiveTab(franchise) {
                try {
                    // Update tab buttons
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    const tabButton = document.querySelector(`[data-franchise="${franchise}"]`);
                    if (tabButton) {
                        tabButton.classList.add('active');
                    } else {
                        console.warn(`Tab button not found for franchise: ${franchise}`);
                    }
                    
                    // Update content
                    document.querySelectorAll('.franchise-content').forEach(content => content.classList.remove('active'));
                    const contentElement = document.getElementById(`content-${franchise}`);
                    if (contentElement) {
                        contentElement.classList.add('active');
                    } else {
                        console.warn(`Content element not found for franchise: ${franchise}`);
                    }
                    
                    this.currentFranchise = franchise;
                } catch (error) {
                    console.error('Error in setActiveTab:', error);
                }
            }
            
            bindEvents() {
                // Tab switching
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.tab-button')) {
                        const franchise = e.target.closest('.tab-button').dataset.franchise;
                        this.setActiveTab(franchise);
                    }
                });
                
                // Search functionality
                document.getElementById('searchBox').addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase();
                    this.filterAgents();
                });
            }
            
            filterAgents() {
                document.querySelectorAll('.agent-card').forEach(card => {
                    const agentName = card.dataset.agent.toLowerCase();
                    const cardText = card.textContent.toLowerCase();
                    
                    if (this.searchTerm === '' || 
                        agentName.includes(this.searchTerm) || 
                        cardText.includes(this.searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        }
        
        // Flow diagram modal functions
        function openFlowModal(franchise) {
            console.log('Opening flow modal for:', franchise);
            const modal = document.getElementById('flowModal');
            const title = document.getElementById('modalTitle');
            const image = document.getElementById('flowImage');
            
            title.textContent = `${franchise.toUpperCase()} Agent Flow Diagram`;
            image.src = `flow_diagrams/${franchise}_flow.png`;
            
            // Handle image load error
            image.onerror = function() {
                console.error('Failed to load image:', this.src);
                this.alt = 'Flow diagram not available';
                this.style.background = '#333';
                this.style.color = '#00ff88';
                this.style.padding = '4rem';
                this.style.textAlign = 'center';
                this.style.fontSize = '1.2rem';
            };
            
            // Show modal with animation
            modal.classList.add('show');
        }
        
        function closeFlowModal() {
            const modal = document.getElementById('flowModal');
            modal.classList.remove('show');
        }
        
        // Close modal when clicking outside content
        document.getElementById('flowModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFlowModal();
            }
        });
        
        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeFlowModal();
                closeFileModal();
            }
        });
        
        // Close file modal when clicking outside content
        document.getElementById('fileModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFileModal();
            }
        });
        
        // Main tab switching
        function showMainTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.main-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content sections
            document.querySelectorAll('.main-content').forEach(content => content.classList.remove('active'));
            
            if (tabName === 'agents') {
                document.getElementById('agentsSection').classList.add('active');
            } else if (tabName === 'cache') {
                document.getElementById('cacheSection').classList.add('active');
                loadCacheDirectory('agency_cache');
            }
        }
        
        // Cache browser functionality
        let currentCachePath = 'agency_cache';
        
        async function loadCacheDirectory(path) {
            try {
                console.log('Loading cache directory:', path);
                currentCachePath = path;
                
                // Update breadcrumb
                document.getElementById('cacheBreadcrumb').textContent = '~/' + path + '/';
                
                // Try to fetch directory listing (this will work if server supports directory listing)
                const response = await fetch(path + '/');
                if (response.ok) {
                    const html = await response.text();
                    parseDirListing(html, path);
                } else {
                    // Fallback: try to load known file types
                    loadCacheDirectoryFallback(path);
                }
            } catch (error) {
                console.warn('Could not load directory listing, using fallback:', error);
                loadCacheDirectoryFallback(path);
            }
        }
        
        function parseDirListing(html, path) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            // Add back button if not in root
            if (path !== 'agency_cache') {
                const backItem = createFileItem('..', 'directory', 0, () => {
                    const parentPath = path.split('/').slice(0, -1).join('/') || 'agency_cache';
                    loadCacheDirectory(parentPath);
                });
                fileList.appendChild(backItem);
            }
            
            // Parse HTML directory listing
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const links = doc.querySelectorAll('a');
            
            links.forEach(link => {
                const href = link.getAttribute('href');
                if (href && href !== '../' && href !== '/') {
                    const fileName = decodeURIComponent(href.replace(/\/$/, ''));
                    const isDirectory = href.endsWith('/');
                    
                    const fileItem = createFileItem(fileName, isDirectory ? 'directory' : 'file', 0, () => {
                        if (isDirectory) {
                            loadCacheDirectory(path + '/' + fileName);
                        } else {
                            loadFileContent(path + '/' + fileName, fileName);
                        }
                    });
                    
                    fileList.appendChild(fileItem);
                }
            });
        }
        
        async function loadCacheDirectoryFallback(path) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            // Add back button if not in root
            if (path !== 'agency_cache') {
                const backItem = createFileItem('..', 'directory', 0, () => {
                    const parentPath = path.split('/').slice(0, -1).join('/') || 'agency_cache';
                    loadCacheDirectory(parentPath);
                });
                fileList.appendChild(backItem);
            }
            
            // Try to load common file patterns
            const commonFiles = [
                'franchise/',
                'assets/',
                'workflows/',
                'outputs/'
            ];
            
            // Add some known JSON files pattern
            const jsonPatterns = [
                '_output.json',
                '_workflow.json', 
                '_cache.json',
                '_analysis.json'
            ];
            
            // Show message about manual exploration
            const infoItem = document.createElement('div');
            infoItem.innerHTML = `
                <div class="file-item" style="border-left: 4px solid #ffaa00; cursor: default;">
                    <div class="file-icon">ℹ️</div>
                    <div class="file-name" style="color: #ffaa00;">
                        Directory listing not available. Try accessing files directly by URL:
                        <br><small style="color: #ccc; font-family: monospace;">
                        http://localhost:8082/${path}/filename.json
                        </small>
                    </div>
                </div>
            `;
            fileList.appendChild(infoItem);
        }
        
        function createFileItem(name, type, size, onClick) {
            const item = document.createElement('div');
            item.className = `file-item ${type}`;
            item.onclick = onClick;
            
            const icon = type === 'directory' ? '📁' : '📄';
            const sizeText = type === 'directory' ? '' : formatFileSize(size);
            
            item.innerHTML = `
                <div class="file-icon">${icon}</div>
                <div class="file-name">${name}</div>
                <div class="file-size">${sizeText}</div>
            `;
            
            return item;
        }
        
        async function loadFileContent(filePath, fileName) {
            try {
                console.log('Loading file:', filePath);
                
                // Show modal immediately with loading state
                openFileModal(fileName, 'Loading file...');
                
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const content = await response.text();
                displayFileInModal(fileName, content);
                
            } catch (error) {
                console.error('Error loading file:', error);
                displayFileInModal(fileName, `Error loading file: ${error.message}`);
            }
        }
        
        function openFileModal(fileName, content) {
            const modal = document.getElementById('fileModal');
            const title = document.getElementById('fileModalTitle');
            const body = document.getElementById('fileModalBody');
            
            title.textContent = `📄 ${fileName}`;
            body.innerHTML = `<pre class="file-modal-pre">${escapeHtml(content)}</pre>`;
            
            modal.classList.add('show');
        }
        
        function displayFileInModal(fileName, content) {
            const title = document.getElementById('fileModalTitle');
            const body = document.getElementById('fileModalBody');
            
            // Try to format JSON
            let formattedContent = content;
            let isJSON = false;
            let fileIcon = '📄';
            
            try {
                if (fileName.endsWith('.json')) {
                    const parsed = JSON.parse(content);
                    formattedContent = JSON.stringify(parsed, null, 2);
                    isJSON = true;
                    fileIcon = '📜';
                }
            } catch (e) {
                // Not valid JSON, use original content
            }
            
            // Update title with file type indicator
            const fileType = isJSON ? ' (JSON)' : '';
            title.innerHTML = `${fileIcon} ${fileName}<span style="color: #00ff88; font-size: 0.8em;">${fileType}</span>`;
            
            // Format content with syntax highlighting for JSON
            const highlightedContent = isJSON ? highlightJSON(formattedContent) : escapeHtml(formattedContent);
            
            body.innerHTML = `<pre class="file-modal-pre ${isJSON ? 'json-highlight' : ''}">${highlightedContent}</pre>`;
        }
        
        function highlightJSON(jsonText) {
            return jsonText
                .replace(/(".*?"):/g, '<span class="json-key">$1</span>:')
                .replace(/: (".*?")/g, ': <span class="json-string">$1</span>')
                .replace(/: (\d+\.?\d*)/g, ': <span class="json-number">$1</span>')
                .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                .replace(/: (null)/g, ': <span class="json-null">$1</span>');
        }
        
        function closeFileModal() {
            const modal = document.getElementById('fileModal');
            modal.classList.remove('show');
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function refreshCache() {
            loadCacheDirectory(currentCachePath);
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new WARPCOREDashboard();
        });
    </script>
</body>
</html>